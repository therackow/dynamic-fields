<form [formGroup]="formGroup" class="container mt-3">
  <div class="row">
    @for (field of fields; track $index) {
      <div
        class="mb-3 col-4"
        [ngClass]="{
          'has-error':
            formGroup.get(field.formControlName)?.invalid &&
            (formGroup.get(field.formControlName)?.dirty ||
              formGroup.get(field.formControlName)?.touched),
        }"
      >
        @if (field.type === "text") {
          <label class="form-label" [ngClass]="{ required: field.required }">{{
            field.label
          }}</label>
          <input
            class="form-control"
            [type]="field.type"
            [placeholder]="field.placeholder"
            [formControlName]="field.formControlName"
          />
        }
        @if (field.type === "select") {
          <label class="form-label" [ngClass]="{ required: field.required }">{{
            field.label
          }}</label>
          <select class="form-select" [formControlName]="field.formControlName">
            <option value="" disabled selected>{{ field.placeholder }}</option>
            @for (option of field.options; track $index) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        }
        @if (field.type === "date") {
          <label class="form-label" [ngClass]="{ required: field.required }">{{
            field.label
          }}</label>
          <div class="input-group">
            <input
              class="form-control"
              [placeholder]="field.placeholder"
              [formControlName]="field.formControlName"
              [minDate]="field.validation.minDate"
              [maxDate]="field.validation.maxDate"
              ngbDatepicker
              #d="ngbDatepicker"
            />
            <button
              class="btn btn-outline-secondary"
              (click)="d.toggle()"
              type="button"
            >
              <fa-icon [icon]="calendarIcon" class="fa-fw"></fa-icon>
            </button>
          </div>
        }
        @if (field.type === "textarea") {
          <label class="form-label" [ngClass]="{ required: field.required }">{{
            field.label
          }}</label>
          <textarea
            class="form-control"
            [placeholder]="field.placeholder"
            [formControlName]="field.formControlName"
            (input)="
              field.characterCount =
                formGroup.get(field.formControlName)?.value?.length || 0
            "
          ></textarea>
          @if (field.validation?.maxLength) {
            <div class="character-counter">
              {{ field.characterCount || 0 }}/{{
                field.validation.maxLength || "âˆž"
              }}
            </div>
          }
        }
        @if (field.type === "checkbox") {
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [formControlName]="field.formControlName"
            />
            <label class="form-check-label">{{ field.label }}</label>
          </div>
        }
        @if (field.type === "radio") {
          <label class="form-label" [ngClass]="{ required: field.required }">{{
            field.label
          }}</label>
          @for (option of field.options; track $index) {
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                [formControlName]="field.formControlName"
                [value]="option.value"
              />
              <label class="form-check-label">{{ option.label }}</label>
            </div>
          }
        }
        @if (
          formGroup.get(field.formControlName)?.invalid &&
          (formGroup.get(field.formControlName)?.dirty ||
            formGroup.get(field.formControlName)?.touched)
        ) {
          <div class="form-text error-text">
            @if (formGroup.get(field.formControlName)?.errors?.["required"]) {
              {{ field.errorMessages.required }}
            }
            @if (formGroup.get(field.formControlName)?.errors?.["minlength"]) {
              {{ field.errorMessages.minlength }}
            }
            @if (formGroup.get(field.formControlName)?.errors?.["maxlength"]) {
              {{ field.errorMessages.maxlength }}
            }
            @if (formGroup.get(field.formControlName)?.errors?.["email"]) {
              {{ field.errorMessages.email }}
            }
            @if (formGroup.get(field.formControlName)?.errors?.["pattern"]) {
              {{ field.errorMessages.pattern }}
            }
            @if (
              formGroup.get(field.formControlName)?.errors?.["ngbDate"][
                "maxDate"
              ]
            ) {
              {{ field.errorMessages.maxDate }}
            }
            @if (
              formGroup.get(field.formControlName)?.errors?.["ngbDate"][
                "minDate"
              ]
            ) {
              {{ field.errorMessages.minDate }}
            }
          </div>
        }
      </div>
    }
  </div>
  <button type="submit" class="btn btn-primary">Submit</button>
</form>
